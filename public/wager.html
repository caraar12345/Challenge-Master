<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Challenge Master</title>
		<meta charset="utf-8">
		<meta name="author" content="Dan-McL">
		<meta name="description" content="Challenge Master Hosts Cyber Security Based Challenges for the Unofficial Cyber Discovery Discord Server">
		<!-- Inits Firebase -->
		<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase-auth.js"></script>
		<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase-database.js"></script>
  		<!-- Style Sheet and Icon -->
  		<link rel="stylesheet" type="text/css" href="style.css">
		<link rel="icon" href="icon.png"></head>
	<body link="black" vlink="black" alink="black">
		<header><h1 class="header">Challenge Master</h1></header>
		<nav>
			<table class="nav">
				<td class="nav"><a class="nav" href="index.html"><h2 class="nav">Scoreboard</h2></a></td>
				<td class="nav"><a class="nav" href="browse.html"><h2 class="nav">Browse</h2></a></td>
				<td class="nav"><a class="nav" href="upload.html"><h2 class="nav">Upload</h2></a></td>
				<td class="nav"><a class="nav" href="info.html"><h2 class="nav">Info</h2></a></td>
				<td class="nav" onclick="viewProfile()"><h2 class="nav">Account</h2></td>
				<td class="nav" onclick="signIn()"><h2 id="signIn" class="nav">Sign In</h2></td>
			</table></nav>
		<section></section>
		<section>
			<div>
				<h2 id="wagerTitle">Wager Title</h2>
				<h3 id="wagerDescription">Wager Descrition</h3>
				<p1 id="wagerContent" style="display: none;">Wager Content</p1>
			</div>
			<div>
				<h3 id="wagerPot">Current Pot: 0</h3>
				<h3 id="entryFee">Entry Fee: 0</h3>
				<p1 id="wagerPlayers"><b>Players: </b></p1>
				<br><button onclick="enter()">Enter</button>
				<br><button onclick="start()" style="display: none;">Start</button>
			</div>
			<div style="display: none;">
				<input id="challengeSolutionInput" type="text">
				<button id="challengeCheck" onclick="check()">Check</button>
			</div>
			<div><H2 style="margin-top:8px; margin-bottom: 8px;">Chat</H2></div>
			<div>
				<div id="messages" style="height:20rem; border:0px; overflow-y:scroll; overflow-x: hidden;"></div>
				<br>
				<input id="message" style="width:95%">
				<button onclick="send()">Send</button></div>
			</div>
		</section>
		<footer>
			<a class="footerNavLink" href="https://discord.gg/8h7HU4C" rel="noopener noreferrer" target="_blank"><H2 class="footerNav">Discord</H2></a>
 			<a class="footerNavLink" href="https://github.com/Dan-McL/Challenge-Master" rel="noopener noreferrer" target="_blank"><H2 class="footerNav">GitHub</H2></a>
			<a class="footerNavLink" href="https://twitter.com/CyberDiscUK" rel="noopener noreferrer" target="_blank"><H2 class="footerNav">Official Twitter</H2></a>
 			<a class="footerNavLink" href="https://joincyberdiscovery.com/" rel="noopener noreferrer" target="_blank"><H2 class="footerNav">Cyber Discovery</H2></a><br><br>
 			<a class="footerNavLink" href="https://raw.githubusercontent.com/Dan-McL/Challenge-Master/master/LICENSE" rel="noopener noreferrer" target="_blank"><p4>Copyright (c) 2017 Daniel</p4></a></div></footer>
		<script src="init.js"></script>
		<script type="text/javascript">
			var user = init();
			firebase.auth().onAuthStateChanged(u => {
				init();
				user = u;
			});
			setupDisplay(user);

			function setupDisplay(user) {
				wid = getParameterByName("wid");
				if (wid === null) {
					document.location.href = "index.html";
				}

				var database = firebase.database();
				database.ref("/wagers/" + wid).once("value").then(wagerSnapshot => {
					var wdata = wagerSnapshot.val()
					document.getElementById("wagerTitle").innerHTML = wdata.wagerTitle;
					document.getElementById("wagerDescription").innerHTML = wdata.wagerDescription;
					document.getElementById("wagerContent").innerHTML = wdata.wagerContent;
					document.getElementById("wagerPot").innerHTML = "Current Pot: " + wdata.wagerPot;
					document.getElementById("entryFee").innerHTML = "Entry Fee: " + wdata.wagerEntryFee;

					if (wagerSnapshot.child("wagerEntrants").exists()) {
						var players = document.getElementById("wagerPlayers");
						wagerSnapshot.child("wagerEntrants").forEach(entrant => {
							database.ref("/users/" + entrant.key).once("value").then(userSnapshot => {
								players.innerHTML = players.innerHTML + "<a style='text-decoration:none' href='user.html?uid=" + entrant.key + "'>" + userSnapshot.val().name + "</a> ";
							});
						});
					}
				});
			}
		</script>
	</body>
